# Deploying to Render

This guide explains how to deploy your portfolio website to Render with PostgreSQL database.

## Prerequisites

- A [Render](https://render.com) account (free tier available)
- Your code pushed to a GitHub repository
- Admin credentials ready (username, password, email)

## Deployment Steps

### Option 1: Using render.yaml (Recommended)

1. **Push your code to GitHub** (if not already done)
   ```bash
   git add .
   git commit -m "Add Render deployment configuration"
   git push origin main
   ```

2. **Create a new Blueprint in Render**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click "New" → "Blueprint"
   - Connect your GitHub repository
   - Render will detect the `render.yaml` file automatically

3. **Set Environment Variables**
   During setup, you'll be prompted to set:
   - `ADMIN_USERNAME` - Your admin username (e.g., "admin")
   - `ADMIN_PASSWORD` - A strong password for admin access
   - `ADMIN_EMAIL` - Your email address
   
   Note: `SECRET_KEY` and `DATABASE_URL` are auto-generated

4. **Deploy**
   - Click "Apply" to create the services
   - Render will create the PostgreSQL database and web service
   - The build script will initialize your database tables
   - Wait for deployment to complete (5-10 minutes)

### Option 2: Manual Setup

1. **Create PostgreSQL Database**
   - Go to Render Dashboard
   - Click "New" → "PostgreSQL"
   - Name it `portfolio-db`
   - Choose Free tier or paid tier
   - Click "Create Database"
   - Copy the "Internal Database URL"

2. **Create Web Service**
   - Click "New" → "Web Service"
   - Connect your GitHub repository
   - Configure:
     - **Name**: portfolio-website
     - **Environment**: Python 3
     - **Build Command**: `./build.sh`
     - **Start Command**: `gunicorn wsgi:app`

3. **Set Environment Variables**
   In the web service settings, add:
   - `DATABASE_URL` - Paste the Internal Database URL from step 1
   - `SECRET_KEY` - Generate with: `python -c "import secrets; print(secrets.token_hex(32))"`
   - `ADMIN_USERNAME` - Your admin username
   - `ADMIN_PASSWORD` - A strong admin password
   - `ADMIN_EMAIL` - Your email address

4. **Deploy**
   - Click "Create Web Service"
   - Render will build and deploy your application
   - The `init_db.py` script will create tables and admin user

## After Deployment

1. **Access Your Site**
   - Your site will be available at: `https://portfolio-website.onrender.com` (or your custom URL)
   - Visit the site to verify it's working

2. **Login to Admin Panel**
   - Go to: `https://your-site.onrender.com/login`
   - Use your ADMIN_USERNAME and ADMIN_PASSWORD
   - Access the dashboard at `/admin/dashboard`

3. **Customize Your Portfolio**
   - Edit your profile information
   - Add projects
   - Upload images

## Important Notes

### Database Persistence
- ✅ PostgreSQL data persists across deployments
- ✅ Your projects, images, and profile stay intact
- ⚠️ Make sure the PostgreSQL service stays active (free tier may pause after 90 days)

### File Uploads
- Images are stored in `app/static/uploads/`
- On Render's free tier, uploaded files persist but may be cleared if the service is inactive
- Consider using cloud storage (AWS S3, Cloudinary) for production

### Free Tier Limitations
- Services spin down after 15 minutes of inactivity
- First request after spin-down takes ~30 seconds
- 750 hours/month of runtime
- Upgrade to paid tier for 24/7 availability

## Troubleshooting

### Database Connection Errors
- Verify DATABASE_URL is set correctly
- Check PostgreSQL service is running
- Ensure `psycopg2-binary` is in requirements.txt

### Build Failures
- Check build logs in Render dashboard
- Ensure `build.sh` has execute permissions
- Verify all dependencies are in requirements.txt

### Tables Not Created
- Check if `init_db.py` ran successfully in build logs
- Manually run: Shell → `python init_db.py`

### Can't Login
- Verify ADMIN_USERNAME and ADMIN_PASSWORD environment variables
- Check if admin user was created (see build logs)
- Try resetting: Shell → `python init_db.py` (creates user if missing)

## Updating Your Site

Push changes to GitHub:
```bash
git add .
git commit -m "Update site"
git push origin main
```

Render will automatically detect changes and redeploy (if auto-deploy is enabled).

## Environment Variables Reference

| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| DATABASE_URL | Yes | PostgreSQL connection string | Auto-generated by Render |
| SECRET_KEY | Yes | Flask secret key for sessions | Auto-generated or custom |
| ADMIN_USERNAME | Yes | Admin login username | admin |
| ADMIN_PASSWORD | Yes | Admin login password | your-secure-password |
| ADMIN_EMAIL | Yes | Admin email address | you@example.com |

## Support

- [Render Documentation](https://render.com/docs)
- [Flask Deployment Guide](https://flask.palletsprojects.com/en/latest/deploying/)
- [PostgreSQL on Render](https://render.com/docs/databases)
